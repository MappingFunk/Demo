(this["webpackJsonpmappingfunk-interface"]=this["webpackJsonpmappingfunk-interface"]||[]).push([[13],{1049:function(e,t,n){"use strict";n.r(t);var a=n(1),o=n.n(a),s=n(7),l=n(28),i=n(79),c=n(33),r=n(18),d=n(716),b=n(1055),p=n(0);const u=Object(r.a)(b.a)((e=>()=>({color:"#52af77",height:320,width:6,"& .MuiSlider-rail":{background:"linear-gradient(180deg, #1DCADA, #FFCC04 40%, #FF6308)",opacity:"1"},"& .MuiSlider-track":{border:"none",background:"transparent"},"& .MuiSlider-thumb":{bottom:0===e.value?"2px !important":e.value>100?"calc(100% - 2px) !important":"",height:6,width:6,boxShadow:"0px 8px 10px rgba(0, 0, 0, 0.25)",background:"#fff",transform:"translate(-24px,50%)",border:"2px solid #000","&:focus, &:hover, &.Mui-active, &.Mui-focusVisible":{boxShadow:"inherit"},"&:before":{position:"absolute",left:2,zIndex:-1,width:20,height:2,background:"#000",borderRadius:1}},"& .MuiSlider-valueLabel":{lineHeight:1.2,fontSize:12,background:"unset",padding:0,width:32,height:32,borderRadius:"50% 50% 50% 0",backgroundColor:"#52af77",transformOrigin:"left",transform:"translate(50%, -100%) rotate(-90deg) scale(0)","&:before":{display:"none"},"&.MuiSlider-valueLabelOpen":{display:"none",transform:"translate(50%, -100%) rotate(-90deg) scale(1)"},"& > *":{transform:"rotate(45deg)"}}})));function j(e){return Object(p.jsx)(u,{valueLabelDisplay:"auto","aria-label":"pretto slider",orientation:"vertical",defaultValue:90,disabled:!0,...e})}var m,h=n(229),f=n(96),x=n(19),O=n(125),g=n(245),y=n(492),k=n(94),v=n(101);const C=Object(r.a)("p")(m||(m=Object(s.a)(["\n  font-family: 'Heebo Regular', serif;\n  font-style: normal;\n  font-weight: 400;\n  font-size: 14px;\n  line-height: 21px;\n  color: rgba(0, 0, 0, 0.5);\n"])));var T=function(e){const{children:t}=e;return Object(p.jsx)(C,{...e,children:t})},I=n(16),w=n(144),S=n(453),N=n(45),A=n(15),P=n(95),M=n(221),V=n(541),F=n(604),D=n(717),R=n(459),B=n(442),W=n(473),E=n(25),z=n(228),_=n(461);var H=function(e){const{walletTokenBalance:t,approveStatus:n,onApprove:o}=e,[s,l]=Object(a.useState)(0),[i,c]=Object(a.useState)(!1),{toastSuccess:r,toastError:d,toastInfo:b}=Object(k.a)(),[u,j]=Object(a.useState)(!1),{currentPosition:m,collateralIndex:h}=Object(w.c)(),{onUpdatePrepaidInterest:f,newDisplayCollateralRatio:x,newDisplayPrepaidInterestCoverage:g}=Object(w.a)(),{handleUpdatePosition:y,onAddPrepaidInterest:C}=Object(w.b)(),T=Object(a.useCallback)(((e,n)=>{const a=0===n?Number(e.target.value):t.WBTC,o=Object(I.c)(I.a.formatTokenAmount(a,E.b.WBTC.decimals),E.b.WBTC.decimals);a>t.WBTC||a<=0||o.isZero()?c(!0):c(!1),f(a),l(0===n?e.target.value:a)}),[f,t.WBTC]),S=Object(a.useCallback)((async()=>{try{if(!s||s<=0&&s>t.WBTC)return void d(P.e.failed,"Please enter a valid amount");c(!0);const e=await C(s);b(P.e.submited,Object(p.jsx)(M.a,{content:"Waiting for confirmation",txHash:e.hash}));await e.wait()&&(r(P.e.success,Object(p.jsx)(M.b,{content:"Settlement added successfully",txHash:e.hash})),c(!1),l(0),f(0),await y())}catch(e){c(!1)}}),[s,t,C,d,b,r,f,y]);return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(W.a,{SelectIcon:z.a,options:E.c,rightOptions:E.c,rightBalance:h.prepaidInterest,leftBalance:t?t.WBTC:0,rightSymbol:m.mintTokenInfo.settlementCurrency.symbol,selectedSymbol:m.mintTokenInfo.settlementCurrency.symbol,RightIcon:()=>Object(p.jsx)("img",{src:v.a.PrepaidInterest,style:{width:20},alt:""}),leftInputValue:s,rightInputValue:s,selectInput:e=>{T(e,0)},onMax:()=>{T({},1)}}),Object(p.jsx)(_.a,{data:[[P.b.CollateralRatio,h.displayRatio,x],[P.b.PrepaidInterestCoverage,h.displayCoverage,g]]}),n?Object(p.jsx)(O.e,{style:{boxShadow:"none"},disabled:i||s<=0,onClick:S,children:"Submit"}):Object(p.jsx)(O.e,{style:{boxShadow:"none"},disabled:u,onClick:()=>{o((e=>{j(e)}))},children:"Approve"})]})},L=n(150);var U=function(e){const{onApprove:t,approveStatus:n,account:o,chainId:s,walletTokenBalance:l}=e,[i,c]=Object(a.useState)(0),[r,d]=Object(a.useState)(!0),[b,u]=Object(a.useState)(!1),{toastError:j,toastSuccess:m}=Object(k.a)(),{currentPosition:h,currentPositionTokenInfo:f,collateralIndex:g}=Object(w.c)(),{onUpdateCollateralValue:y,newDisplayCollateralRatio:v,newDisplayPrepaidInterestCoverage:C}=Object(w.a)(),{handleUpdatePosition:T}=Object(w.b)(),N=Object(L.b)(),A=Object(a.useMemo)((()=>{const{allowedTokens:e}=f;return Array.from(Object.values(e.tokens)).map((t=>({...t,token:t.symbol,icon:()=>Object(p.jsx)(S.a,{imgprops:{style:{marginRight:10}},token:t.logo,symbol:t.symbol}),balance:l[t.symbol],rightOptionList:[{...t,token:t.symbol,icon:()=>Object(p.jsx)(S.a,{imgprops:{style:{marginRight:10}},token:t.logo,symbol:t.symbol}),balance:Object(I.b)(e.balances[t.symbol],t.decimals)}]})))}),[f,l]),[V,F]=Object(a.useState)(0),D=Object(a.useMemo)((()=>A.length&&A[V]||{...h.mintTokenInfo.settlementCurrency,balance:l[h.mintTokenInfo.settlementCurrency.symbol]}),[h.mintTokenInfo.settlementCurrency,V,A,l]),R=Object(a.useMemo)((()=>A.length&&A[V].rightOptionList[0]||{...h.mintTokenInfo.settlementCurrency,balance:Object(I.b)(f.allowedTokens.balances[h.mintTokenInfo.settlementCurrency.symbol],h.mintTokenInfo.settlementCurrency.decimals)}),[null===h||void 0===h?void 0:h.mintTokenInfo.settlementCurrency,null===f||void 0===f?void 0:f.allowedTokens.balances,V,A]),B=Object(a.useCallback)((async()=>{try{d(!0);const e=await N(o,E.b[D.symbol].address[s],null===h||void 0===h?void 0:h.positionAddress,Object(I.c)(I.a.formatTokenAmount(i,E.b[D.symbol].decimals),E.b[D.symbol].decimals));e&&(d(!1),c(0),m(P.e.success,Object(p.jsx)(M.b,{content:"Collateral added successfully.",txHash:e.transactionHash})),y({symbol:D.symbol,value:0}),await T())}catch(e){console.dir(e),j(P.e.failed,null===e||void 0===e?void 0:e.reason),d(!1)}}),[N,o,D,s,h,i,m,y,T,j]);return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(W.a,{options:A,rightOptions:A,leftInputValue:i,leftBalance:D.balance,leftSelectValue:D.symbol,rightInputValue:i,rightBalance:R.balance,rightSelectValue:R.symbol,SelectIcon:z.a,selectInput:e=>{let{target:t}=e;if(c(t.value),t.value>0&&t.value<=D.balance){const e=Object(I.c)(I.a.formatTokenAmount(t.value,D.decimals),D.decimals);d(e.isZero())}else d(!0);y({symbol:D.symbol,value:t.value})},leftChange:e=>{const t=A.findIndex((t=>t.symbol===e.symbol));F(t),c(0),y({symbol:e.symbol,value:0})},onMax:()=>{l&&D.balance&&(c(D.balance),y({symbol:D.symbol,value:D.balance}),D.balance>0&&d(!1))},RightIcon:x.b}),Object(p.jsx)(_.a,{data:[["Collateral Ratio",g.displayRatio,v],["Prepaid Interest Coverage",g.displayCoverage,C]]}),Object(p.jsxs)(O.k,{children:[Object(p.jsx)(O.h,{style:{background:"#FF7D00",color:"#fff"},children:"!"}),Object(p.jsx)("p",{children:"Add asset to Collateral won\u2019t effect the Prepaid Interest Coverage, so you might need to add the specific asset in method 1 first."})]}),n?Object(p.jsx)(O.e,{style:{boxShadow:"none"},disabled:r||i<=0,onClick:B,children:"Submit"}):Object(p.jsx)(O.e,{style:{boxShadow:"none"},disabled:b,onClick:()=>{t((e=>{u(e)}))},children:"Approve"})]})};function G(e){const{approveStatus:t,onApprove:n}=e,{walletTokenBalance:a}=Object(B.a)(),{expanded:o,handleChange:s}=Object(R.a)(),{active:i,chainId:c,account:r}=Object(l.b)();return Object(p.jsxs)(O.m,{children:[Object(p.jsx)(O.l,{children:"Add collateral before mint"}),Object(p.jsxs)(O.a,{id:"panel1",expanded:"panel1"===o,onChange:s("panel1"),children:[Object(p.jsx)(O.c,{"aria-controls":"panel1d-content",children:Object(p.jsx)(D.a,{children:"Method 1. Add asset from my wallet to Prepaid Interest"})}),Object(p.jsx)(O.b,{children:"panel1"===o&&Object(p.jsx)(H,{active:i,account:r,chainId:c,walletTokenBalance:a,onApprove:n,approveStatus:t})})]}),Object(p.jsxs)(O.a,{id:"panel2",expanded:"panel2"===o,onChange:s("panel2"),children:[Object(p.jsx)(O.c,{"aria-controls":"panel1d-content",children:Object(p.jsx)(D.a,{children:"Method 2. Add asset from my wallet to Collateral"})}),Object(p.jsx)(O.b,{children:"panel2"===o&&Object(p.jsx)(U,{active:i,account:r,chainId:c,walletTokenBalance:a,onApprove:n,approveStatus:t})})]})]})}var Z=n(60),Y=n(67),q=n(14),K=n(110),J=n(111),X=n(30),Q=n(151);const{ActionUser:$}=Z.a,ee=new Y.utils.Interface($.abi),te=e=>{const{approveStatus:t,onApprove:n}=e,[o,s]=Object(a.useState)(!0),{chainId:i,account:c}=Object(l.b)(),{currentPosition:r,collateralIndex:d}=Object(w.c)(),[b,u]=Object(a.useState)(!1),[j,m]=Object(a.useState)(0),{toastError:h,toastSuccess:f,toastInfo:g}=Object(k.a)(),{walletTokenBalance:y}=Object(B.a)(),{signer:v}=Object(K.a)(),[C,T]=Object(a.useState)(!1),{onUpdatePrepaidInterest:N,newDisplayCollateralRatio:A,newPrepaidInterestCoverage:V,newCollateralRatio:F,newDisplayPrepaidInterestCoverage:D,minCollateralValue:R}=Object(w.a)(),{handleUpdatePosition:H}=Object(w.b)(),L=Object(a.useCallback)((async()=>{try{u(!0);const e=ee.encodeFunctionData("moveGuarantee",[c,Object(I.c)(j.toString(),E.b.WBTC.decimals)]),t=new q.ethers.Contract(r.positionAddress,J,v),n=await t.delegateCall($.address[i],e);if(n){m(0),g(P.e.submited,Object(p.jsx)(M.a,{content:"Waiting for confirmation",txHash:n.hash}));await n.wait()&&(u(!1),f(P.e.success,Object(p.jsx)(M.a,{content:"The transactions was successful",txHash:n.hash})),await H())}}catch(e){u(!1),h(P.e.failed,null===e||void 0===e?void 0:e.reason)}}),[c,i,r.positionAddress,H,v,h,g,f,j]);Object(a.useEffect)((()=>{F<120||V<20||j<=0||j>d.prepaidInterest||b?s(!0):s(!1)}),[d.prepaidInterest,F,V,b,j]),Object(a.useEffect)((()=>{const e=Number("-".concat(j));N(Number.isNaN(e)?0:e)}),[N,j]);const U=Object(a.useMemo)((()=>[{decimals:r.mintTokenInfo.settlementCurrency.decimals,token:r.mintTokenInfo.settlementCurrency.symbol,balance:d.prepaidInterest,icon:()=>Object(p.jsx)(S.a,{imgprops:{style:{marginRight:10}},token:r.mintTokenInfo.settlementCurrency.logo,symbol:r.mintTokenInfo.settlementCurrency.symbol}),rightOptionList:[{decimals:r.mintTokenInfo.settlementCurrency.decimals,token:r.mintTokenInfo.settlementCurrency.symbol,balance:y[r.mintTokenInfo.settlementCurrency.symbol],icon:()=>Object(p.jsx)(S.a,{imgprops:{style:{marginRight:10}},token:r.mintTokenInfo.settlementCurrency.logo,symbol:r.mintTokenInfo.settlementCurrency.symbol})}]}]),[d,r,y]);return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(W.a,{selectInput:e=>{m(e.target.value)},onMax:()=>{const e=20*r.positionStatus.estimatedDailyDebt.toNumber(),t=Number(d.prepaidInterest)-Object(I.b)(e,r.mintTokenInfo.settlementCurrency.decimals,!0);m(t>R?R:t)},SelectIcon:x.k,options:U,leftBalance:d.prepaidInterest,rightBalance:y&&y[r.mintTokenInfo.settlementCurrency.symbol],rightSelectedValue:42,rightSymbol:"WBTC",selectValue:42,selectedBalance:100,selectedSymbol:"WBTC",leftInputValue:j,rightInputValue:j,RightIcon:z.a}),Object(p.jsx)(_.a,{data:[["Collateral Ratio",d.displayRatio,A],["Prepaid Interest Coverage",d.displayCoverage,D]]}),t?Object(p.jsx)(O.e,{style:{boxShadow:"none"},disabled:o,onClick:L,children:"Submit"}):Object(p.jsx)(O.e,{style:{boxShadow:"none"},disabled:C,onClick:()=>{n((e=>{T(e)}))},children:"Approve"})]})};function ne(e){const{chainId:t,account:n}=Object(l.b)(),{approveStatus:o,onApprove:s}=e,{signer:i}=Object(K.a)(),{walletTokenBalance:c}=Object(B.a)(),[r,d]=Object(a.useState)(0),{tokenPools:b}=Object(K.a)(),[u,j]=Object(a.useState)({balance:0,token:X.c.WBTC,decimals:8,address:"",symbol:X.c.WBTC}),[m,h]=Object(a.useState)({balance:0,token:X.c.WBTC,decimals:8,address:"",symbol:X.c.WBTC}),[f,g]=Object(a.useState)(!0),[y,v]=Object(a.useState)(!1),{currentPosition:C,currentPositionTokenInfo:T,collateralIndex:N}=Object(w.c)(),{onUpdateCollateralValue:A,newDisplayCollateralRatio:V,newCollateralRatio:F,newDisplayPrepaidInterestCoverage:H,minCollateralValue:L}=Object(w.a)(),{handleUpdatePosition:U}=Object(w.b)(),{toastError:G,toastSuccess:Z,toastInfo:Y}=Object(k.a)(),{expanded:ne,handleChange:ae}=Object(R.a)(),[oe,se]=Object(a.useState)(!1);Object(a.useEffect)((()=>{if(u){!Object(I.c)(I.a.formatTokenAmount(r,u.decimals),u.decimals).isZero()&&r<=u.balance&&!oe?g(!1):g(!0),F<=120&&g(!0)}}),[u,r,oe,F]),Object(a.useEffect)((()=>{const e=Number("-".concat(r));A({symbol:u.token,value:Number.isNaN(e)?0:e})}),[u,A,r]);const le=Object(a.useCallback)((async()=>{if(se(!0),g(!0),r<=0)return se(!1),void G(P.e.failed,"Please enter a valid amount");const e=ee.encodeFunctionData("withdrawAsset",[E.b[u.token].address[t],n,Object(I.c)(I.a.formatTokenAmount(r,u.decimals),u.decimals)]);try{const n=new q.ethers.Contract(C.positionAddress,J,i),a=await n.delegateCall($.address[t],e);if(a.hash){Y(P.e.submited,Object(p.jsx)(M.a,{content:"Waiting for confirmation",txHash:a.hash}));await a.wait()&&(se(!1),Z(P.e.success,Object(p.jsx)(M.a,{content:"The transactions was successful",txHash:a.hash})),d(0),await U())}}catch(a){se(!1),G(P.e.failed,null===a||void 0===a?void 0:a.reason)}}),[u,t,n,r,C.positionAddress,i,Y,Z,U,G]),ie=Object(a.useMemo)((()=>{const{allowedTokens:e}=T;return e.tokens?Object.keys(e.tokens).map((t=>{const n=e.tokens[t],a={icon:()=>Object(p.jsx)(S.a,{imgprops:{style:{marginRight:10}},token:n.logo,symbol:n.symbol}),token:n.symbol,balance:Object(I.b)(e.balances[t],n.decimals,!0),decimals:n.decimals,address:n.address};return{...a,rightOptionList:[{...a,balance:c[t]}]}})):[]}),[T,c]);return Object(a.useEffect)((()=>{const e=ie.find((e=>e.token===C.mintTokenInfo.settlementCurrency.symbol))||ie[0];j(e),h(e)}),[C.mintTokenInfo.settlementCurrency.symbol,ie]),Object(p.jsxs)(O.m,{children:[Object(p.jsx)(O.l,{children:"Withdraw Collateral"}),Object(p.jsxs)(O.a,{id:"panel13",expanded:"panel13"===ne,onChange:ae("panel13"),children:[Object(p.jsx)(O.c,{"aria-controls":"panel1d-content",children:Object(p.jsx)(D.a,{children:"Method 1. Withdraw asset from Collateral to my wallet"})}),Object(p.jsxs)(O.b,{children:[Object(p.jsx)(W.a,{rightOptions:[m],SelectIcon:x.b,options:ie,leftSelectValue:u?u.token:"",rightSelectValue:m?m.token:"",rightBalance:m.balance,leftInputValue:r,rightInputValue:r,leftChange:e=>{j(e),h(e.rightOptionList[0])},selectInput:e=>{d(e.target.value),e.target.value>0&&e.target.value<=u.balance?g(!1):g(!0)},onMax:()=>{(e=>{const{settlementCurrency:n}=C.mintTokenInfo;if(1===e)if(u.token===n.symbol)L<u.balance?d(L):d(u.balance);else{const e=Object(Q.b)(t,u.token,n.symbol,Object(I.c)(I.a.formatTokenAmount(L,n.decimals),n.decimals),b),a=Object(I.b)(e,u.decimals,!0);a<u.balance?d(Number(I.a.formatTokenAmount(a,u.decimals))):d(u.balance)}})(1)},RightIcon:z.a}),Object(p.jsx)(_.a,{data:[[P.b.CollateralRatio,N.displayRatio,V],[P.b.PrepaidInterestCoverage,N.displayCoverage,H]]}),o?Object(p.jsx)(O.e,{style:{boxShadow:"none"},disabled:f,onClick:le,children:"Submit"}):Object(p.jsx)(O.e,{style:{boxShadow:"none"},disabled:y,onClick:()=>{s((e=>{v(e)}))},children:"Approve"})]})]}),Object(p.jsxs)(O.a,{id:"panel14",expanded:"panel14"===ne,onChange:ae("panel14"),children:[Object(p.jsx)(O.c,{"aria-controls":"panel1d-content",children:Object(p.jsx)(D.a,{children:"Method 2. Withdraw asset from Prepaid Interest to my wallet"})}),Object(p.jsx)(O.b,{children:Object(p.jsx)(te,{...e})})]})]})}var ae,oe,se,le,ie,ce,re=n(431),de=n(542);const be=Object(r.a)("div")(ae||(ae=Object(s.a)(["\n  button.MuiSelectUnstyled-root {\n    width: 200px;\n  }\n\n  div.MuiInput-root {\n    width: calc(100% - 200px) !important;\n  }\n\n  div.topFunc {\n    display: flex;\n    align-items: center;\n    padding: 5px 10px;\n\n    span {\n      margin-left: 10px;\n      font-size: 12px;\n      color: rgba(0, 0, 0, 0.5);\n    }\n  }\n"]))),pe=Object(r.a)("div")(oe||(oe=Object(s.a)(["\n  display: flex;\n  align-items: flex-start;\n  flex-direction: column;\n  margin-top: 20px;\n  margin-bottom: 18px;\n  font-weight: 500;\n  font-size: 12px;\n  line-height: 17px;\n  color: rgba(0, 0, 0, 0.5);\n  background: #def1ff;\n  border-radius: 14px;\n  padding: 16px 19px 11px;\n  p span:first-of-type {\n    margin-right: 10px;\n  }\n\n  & + p {\n    font-weight: 400;\n    font-size: 12px;\n    line-height: 17px;\n    color: #000000;\n    margin-bottom: 30px;\n  }\n\n  .info_panel {\n    width: 100%;\n    text-align: right;\n    .footer {\n      border-top: 0.5px solid rgba(0, 0, 0, 0.12);\n    }\n    td {\n      font-family: PingFangSC-Regular, sans-serif;\n      font-weight: 400;\n      font-size: 12px;\n      padding: 5px 0;\n    }\n    .label {\n      text-align: left;\n      width: 30%;\n    }\n    .from,\n    .to {\n      width: 35%;\n      line-height: 17px;\n    }\n    .to {\n      font-family: PingFangSC-Medium, sans-serif;\n      font-weight: 500;\n      color: #000;\n    }\n  }\n"]))),ue=Object(r.a)("div")(se||(se=Object(s.a)(["\n  padding: 10px 20px 5px;\n\n  button {\n    color: #2aa1ff;\n  }\n"]))),je=Object(r.a)(x.c)(le||(le=Object(s.a)(["\n  background: linear-gradient(90deg, #61c2f7 0%, #7ae9f0 100%);\n  border-radius: 20px !important;\n  box-shadow: none !important;\n  line-height: 46px !important;\n  height: 46px !important;\n  display: block !important;\n  margin: 30px auto 0 !important;\n  width: 30% !important;\n  color: #000;\n"]))),me=Object(r.a)("div")(ie||(ie=Object(s.a)(["\n  h3 {\n    font-size: 16px;\n    font-family: PingFangSC-Medium, sans-serif;\n    margin-bottom: 16px;\n  }\n  .content {\n    display: flex;\n  }\n  .item_wrap {\n    min-width: 200px;\n    padding: 1px;\n    border-radius: 14px;\n    overflow: hidden;\n    margin-right: 16px;\n    background: #e3e8ed;\n    cursor: pointer;\n    user-select: none;\n    span {\n      font-family: PingFangSC-Regular, sans-serif;\n      color: rgba(0, 0, 0, 0.5);\n      font-size: 12px;\n      line-height: 17px;\n      &:first-of-type {\n        margin-right: 30px;\n      }\n    }\n    &.active {\n      padding: 2px;\n      background: linear-gradient(270deg, #7ae9f0 0%, #61c3f7 100%);\n      span {\n        color: #000;\n      }\n    }\n  }\n  .item {\n    border-radius: 12px;\n    //border: 2px solid #E3E8ED;\n    //border-image: linear-gradient(#7AE9F0 , #61C3F7) 30 30;\n    padding: 14px 14px 9px 10px;\n    background: #fff;\n    width: 100%;\n    height: 100%;\n    //box-sizing: border-box;\n    h4 {\n      font-family: PingFangSC-Semibold, sans-serif;\n      font-weight: 550;\n      display: flex;\n      align-items: center;\n      line-height: 20px;\n      font-size: 14px;\n      margin-bottom: 22px;\n      svg {\n        margin-right: 8.5px;\n      }\n    }\n    p {\n      display: flex;\n      justify-content: space-between;\n    }\n  }\n"]))),he=Object(r.a)("div")(ce||(ce=Object(s.a)(["\n  display: flex;\n  align-items: center;\n  background: rgba(0, 0, 0, 0.03);\n  border-radius: 8px;\n  padding: 16px 20px;\n  p {\n    line-height: 20px;\n    font-size: 14px;\n    font-family: PingFangSC-Regular, sans-serif;\n    margin-left: 16px;\n    color: rgba(0, 0, 0, 0.5);\n  }\n"]))),fe="red";var xe=function(e){return e.Wallet="wallet",e.Avatar="avatar",e}(xe||{});const{ActionUser:Oe}=Z.a;var ge=function(){const{setRefresh:e,walletTokenBalance:t}=Object(B.a)(),{signer:n}=Object(K.a)(),{active:o,chainId:s,account:i}=Object(l.b)(),[c,r]=Object(a.useState)(!1),[d,b]=Object(a.useState)(!0),[u,j]=Object(a.useState)(0),m=Object(de.a)(o,n),[f,O]=Object(a.useState)(xe.Wallet),{toastSuccess:g,toastError:v,toastInfo:C}=Object(k.a)(),{currentMintToken:T,currentPosition:S,currentPositionTokenInfo:N,collateralIndex:A}=Object(w.c)(),{onUpdateNeutralizeValue:V,newNeutralizeFee:F,newDisplayCollateralRatio:D,newDisplayPrepaidInterestCoverage:R,newEstimatedDailyDebt:W}=Object(w.a)(),{handleUpdatePosition:E}=Object(w.b)(),{handleApprove:_}=Object(y.a)(i,null===S||void 0===S?void 0:S.mintTokenInfo.address),{onCheckApprove:H}=Object(y.b)(),L=Object(a.useCallback)((async()=>{try{const e=await _(null===S||void 0===S?void 0:S.positionAddress);if(r(!0),e.hash){C(P.e.submited,Object(p.jsx)(M.b,{txHash:e.hash,content:"The approve has been submitted"}));await e.wait()&&g(P.e.success,Object(p.jsx)(M.b,{txHash:e.hash,content:"The approve has been successfully"}))}}catch({message:e}){r(!1),v(P.e.failed,"".concat(e))}}),[_,null===S||void 0===S?void 0:S.positionAddress,C,g,v]),U=Object(a.useMemo)((()=>{const e=null===S||void 0===S?void 0:S.mintTokenInfo.settlementCurrency;return null!==N&&void 0!==N&&N.allowedTokens?{[e.symbol]:Number(I.a.formatFourDecimals(Number(Object(I.b)(N.allowedTokens.balances[e.symbol],e.decimals)))),[T]:Number(I.a.formatFourDecimals(Number(Object(I.b)(N.allowedTokens.balances[S.mintTokenInfo.symbol],S.mintTokenInfo.decimals))))}:{[e.symbol]:0,[T]:0}}),[T,S,N]),G=Object(a.useCallback)((async()=>{if(S.isEnable){const e=await H(i,S.mintTokenInfo.address,S.positionAddress);r(e&&e._hex>0)}}),[i,S,H]),Z=Object(a.useCallback)((e=>{let{target:n}=e;const{value:a}=n,{mintTokenInfo:o,balance:s}=S,l=o.decimals;j(a);const i=a?Number("-".concat(a)):0,c=Number(I.a.formatTokenAmount(i,l));V(c);const r=Object(I.b)(s,l),d=a>0&&a<=r,p=d&&a<=t[T],u=d&&a<=U[T],m=f===xe.Wallet?p:u;if(b(!m),a>0){const e=Object(I.c)(I.a.formatTokenAmount(a,l),l),t=m&&!e.isZero();b(!t)}}),[V,U,T,t,f,S]),q=Object(a.useCallback)((async()=>{if(!d){const n=new Y.utils.Interface(Oe.abi).encodeFunctionData("neutralizetBalance",[Object(I.c)(I.a.formatTokenAmount(u,S.mintTokenInfo.decimals),S.mintTokenInfo.decimals),f===xe.Wallet]);if(m)try{const t=await m.delegateCall(Oe.address[s],n);if(t){b(!0),j(0),C(P.e.success,Object(p.jsx)(M.b,{txHash:t.hash,content:"Waiting for confirmation"}));await t.wait()&&(e((e=>!e)),g(P.e.success,Object(p.jsx)(M.b,{txHash:t.hash,content:"The transaction has been successfully"})),b(!1),V(0),await E())}}catch(t){v(P.e.failed,(null===t||void 0===t?void 0:t.reason)||(null===t||void 0===t?void 0:t.message))}}}),[d,u,S.mintTokenInfo.decimals,f,m,s,C,e,g,V,E,v]);return Object(a.useEffect)((()=>{G()}),[G]),Object(p.jsxs)(p.Fragment,{children:[Object(p.jsxs)(be,{children:[Object(p.jsx)(h.a,{selectValue:T,groupStyle:{width:"100%"},options:[{...null===S||void 0===S?void 0:S.mintTokenInfo,token:S.mintTokenInfo.symbol}],actionValue:u,selectInput:Z,isGroup:!0}),Object(p.jsx)(ue,{dir:"rtl",children:Object(p.jsx)(re.a,{onClick:()=>{const e=Object(I.b)(S.balance,S.mintTokenInfo.decimals);if(f===xe.Wallet){const n=Math.min(Number(t[T]),Number(e));Z({target:{value:n}})}else{const t=Math.min(Number(U[T]),Number(e));Z({target:{value:t}})}},children:"Max"})}),Object(p.jsxs)(me,{children:[Object(p.jsx)("h3",{children:"Neutralize the asset from"}),Object(p.jsxs)("div",{className:"content",children:[Object(p.jsx)("div",{className:"item_wrap ".concat(f===xe.Wallet?"active":""),onClick:()=>{O(xe.Wallet),u>0&&b(F>t.WBTC||u>t[T])},onKeyUp:()=>null,tabIndex:0,role:"button",children:Object(p.jsxs)("div",{className:"item wallet",children:[Object(p.jsxs)("h4",{children:[Object(p.jsx)(z.a,{})," My Wallet"]}),Object(p.jsxs)("p",{children:[Object(p.jsx)("span",{children:T}),Object(p.jsx)("span",{style:{color:f===xe.Wallet&&t&&u>t[T]&&fe||""},children:t&&I.a.formatFourDecimals(t[T])||0})]}),Object(p.jsxs)("p",{children:[Object(p.jsx)("span",{children:S.mintTokenInfo.settlementCurrency.symbol}),Object(p.jsx)("span",{style:{color:f===xe.Wallet&&t&&F>t[S.mintTokenInfo.settlementCurrency.symbol]?fe:""},children:t&&I.a.formatFourDecimals(t.WBTC)||0})]})]})}),Object(p.jsx)("div",{className:"item_wrap ".concat(f===xe.Avatar?"active":""),onClick:()=>{O(xe.Avatar),u>0&&b(u>U[T]||F>U[S.mintTokenInfo.settlementCurrency.symbol])},onKeyUp:()=>null,tabIndex:0,role:"button",children:Object(p.jsxs)("div",{className:"item avatar",children:[Object(p.jsxs)("h4",{children:[Object(p.jsx)(x.b,{}),"Collateral"]}),Object(p.jsxs)("p",{children:[Object(p.jsx)("span",{children:T}),Object(p.jsx)("span",{style:{color:f===xe.Avatar&&u>U[T]&&fe||""},children:U[S.mintTokenInfo.symbol]})]}),Object(p.jsxs)("p",{children:[Object(p.jsx)("span",{children:S.mintTokenInfo.settlementCurrency.symbol}),Object(p.jsx)("span",{style:{color:f===xe.Avatar&&F>U[S.mintTokenInfo.settlementCurrency.symbol]&&fe||""},children:U[S.mintTokenInfo.settlementCurrency.symbol]})]})]})})]})]})]}),Object(p.jsx)(pe,{children:Object(p.jsxs)("table",{className:"info_panel",cellSpacing:20,cellPadding:20,children:[Object(p.jsxs)("thead",{children:[Object(p.jsxs)("tr",{children:[Object(p.jsx)("td",{className:"from",colSpan:2,children:"From"}),Object(p.jsx)("td",{className:"to",children:"To"})]}),Object(p.jsxs)("tr",{children:[Object(p.jsx)("td",{className:"label",children:"Outstanding Debt"}),Object(p.jsx)("td",{className:"from",children:I.a.formatFourDecimals(Number(Object(I.b)(null===S||void 0===S?void 0:S.balance,null===S||void 0===S?void 0:S.mintTokenInfo.decimals)))}),Object(p.jsx)("td",{className:"to",children:I.a.formatFourDecimals(Number(Object(I.b)(null===S||void 0===S?void 0:S.balance,null===S||void 0===S?void 0:S.mintTokenInfo.decimals))-u)})]})]}),Object(p.jsxs)("tbody",{children:[Object(p.jsxs)("tr",{children:[Object(p.jsx)("td",{className:"label",children:P.b.CollateralRatio}),Object(p.jsx)("td",{className:"from",children:A.displayRatio}),Object(p.jsx)("td",{className:"to",children:D})]}),Object(p.jsxs)("tr",{children:[Object(p.jsx)("td",{className:"label",children:P.b.PrepaidInterestCoverage}),Object(p.jsx)("td",{className:"from",children:A.displayCoverage}),Object(p.jsx)("td",{className:"to",children:R})]}),Object(p.jsxs)("tr",{className:"footer",children:[Object(p.jsx)("td",{className:"label",children:"Estimate neutralize fee"}),Object(p.jsx)("td",{className:"to",colSpan:2,style:{color:f===xe.Wallet&&t&&F>t[S.mintTokenInfo.settlementCurrency.symbol]||f===xe.Avatar&&F>U[S.mintTokenInfo.settlementCurrency.symbol]?fe:""},children:F?"\u2248 ".concat(I.a.formatTokenAmount(F,S.mintTokenInfo.settlementCurrency.decimals)," ").concat(S.mintTokenInfo.settlementCurrency.symbol):0})]})]})]})}),Object(p.jsxs)(he,{children:[f===xe.Wallet&&t&&F>t[S.mintTokenInfo.settlementCurrency.symbol]||f===xe.Avatar&&F>U[S.mintTokenInfo.settlementCurrency.symbol]?Object(p.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[Object(p.jsx)("path",{d:"M8 16C12.4183 16 16 12.4183 16 8C16 3.58172 12.4183 0 8 0C3.58172 0 0 3.58172 0 8C0 12.4183 3.58172 16 8 16Z",fill:"#FF2E00"}),Object(p.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8.57852 10.156C8.82398 10.156 9.02296 10.355 9.02296 10.6004V11.756C9.02296 12.0015 8.82398 12.2004 8.57852 12.2004H7.42296C7.1775 12.2004 6.97852 12.0015 6.97852 11.756V10.6004C6.97852 10.355 7.1775 10.156 7.42296 10.156H8.57852ZM8.57852 3.62842C8.82398 3.62842 9.02296 3.8274 9.02296 4.07286V8.74859C9.02296 8.99405 8.82398 9.19303 8.57852 9.19303H7.42296C7.1775 9.19303 6.97852 8.99405 6.97852 8.74859V4.07286C6.97852 3.8274 7.1775 3.62842 7.42296 3.62842H8.57852Z",fill:"white"})]}):Object(p.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[Object(p.jsx)("path",{d:"M8 16C12.4183 16 16 12.4183 16 8C16 3.58172 12.4183 0 8 0C3.58172 0 0 3.58172 0 8C0 12.4183 3.58172 16 8 16Z",fill:"#73797C"}),Object(p.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.42295 5.6736C7.17749 5.6736 6.9785 5.47461 6.9785 5.22915V4.0736C6.9785 3.82814 7.17749 3.62915 7.42295 3.62915H8.5785C8.82396 3.62915 9.02295 3.82814 9.02295 4.0736L9.02295 5.22915C9.02295 5.47461 8.82396 5.6736 8.5785 5.6736H7.42295ZM7.42295 12.2012C7.17749 12.2012 6.9785 12.0022 6.9785 11.7567V7.081C6.9785 6.83554 7.17749 6.63656 7.42295 6.63656H8.5785C8.82396 6.63656 9.02295 6.83554 9.02295 7.081V11.7567C9.02295 12.0022 8.82396 12.2012 8.5785 12.2012H7.42295Z",fill:"white"})]}),Object(p.jsx)("p",{style:{color:f===xe.Wallet&&t&&F>t[S.mintTokenInfo.settlementCurrency.symbol]||f===xe.Avatar&&F>U[S.mintTokenInfo.settlementCurrency.symbol]?fe:""},children:"A 1.0% fee of the token value will be levied after the position is neutralized."})]}),f===xe.Avatar?Object(p.jsx)(je,{disabled:d,onClick:q,children:"Neutralize"}):Object(p.jsx)(p.Fragment,{children:c?Object(p.jsx)(je,{disabled:d,onClick:q,children:"Neutralize"}):Object(p.jsx)(je,{disabled:c,onClick:L,children:"Approve"})})]})};var ye=function(e){var t;const{approveStatus:n,onApprove:o}=e,[s,l]=Object(a.useState)(0),[i,c]=Object(a.useState)(!1),{toastSuccess:r,toastError:d,toastInfo:b}=Object(k.a)(),{collateralIndex:u,currentPosition:j,currentPositionTokenInfo:m}=Object(w.c)(),{onUpdatePrepaidInterest:h,newDisplayPrepaidInterestCoverage:f}=Object(w.a)(),{handleUpdatePosition:g,onAddPrepaidInterest:y}=Object(w.b)(),v=Object(a.useMemo)((()=>{var e,t;return Object(I.b)(null!==(e=null===(t=m.allowedTokens)||void 0===t?void 0:t.balances[j.mintTokenInfo.settlementCurrency.symbol])&&void 0!==e?e:0,j.mintTokenInfo.settlementCurrency.decimals,!0)}),[j.mintTokenInfo.settlementCurrency,null===(t=m.allowedTokens)||void 0===t?void 0:t.balances]),C=Object(a.useCallback)(((e,t)=>{const n=0===t?Number(e.target.value):v,a=Object(I.c)(I.a.formatTokenAmount(n,E.b.WBTC.decimals),E.b.WBTC.decimals);n>v||n<=0||a.isZero()?c(!0):c(!1),l(0===t?e.target.value:n),h(n)}),[v,h]),T=Object(a.useCallback)((async()=>{try{if(!s||s>v&&s<=0)return void d(P.e.failed,"Please enter a valid amount");c(!0);const e=await y(s);b(P.e.submited,Object(p.jsx)(M.a,{content:"Waiting for confirmation",txHash:e.hash}));await e.wait()&&(r(P.e.success,Object(p.jsx)(M.b,{content:"Settlement added successfully",txHash:e.hash})),c(!1),l(0),h(0),await g())}catch(e){c(!1)}}),[s,v,y,b,r,g,h,d]);return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(W.a,{SelectIcon:x.b,options:E.c,rightBalance:u.prepaidInterest,rightOptions:E.c,leftBalance:v,rightSymbol:j.mintTokenInfo.settlementCurrency.symbol,selectedSymbol:j.mintTokenInfo.settlementCurrency.symbol,RightIcon:x.k,leftInputValue:s,rightInputValue:s,selectInput:e=>{C(e,0)},onMax:()=>{C({},1)}}),Object(p.jsx)(_.a,{data:[[P.b.CollateralRatio,u.displayRatio,u.displayRatio],[P.b.PrepaidInterestCoverage,u.displayCoverage,f]]}),Object(p.jsx)(O.e,{style:{boxShadow:"none"},disabled:!n||i||!(s>0),onClick:n?T:o,children:n?"Submit":"Approve"})]})};function ke(e){const{approveStatus:t,onApprove:n}=e,{active:a,chainId:o,account:s}=Object(l.b)(),{walletTokenBalance:i}=Object(B.a)(),{expanded:c,handleChange:r}=Object(R.a)();return Object(p.jsxs)(O.m,{children:[Object(p.jsx)(O.l,{children:"Improve Prepaid Interest Coverage"}),Object(p.jsxs)(O.a,{id:"panel3",expanded:"panel3"===c,onChange:r("panel3"),children:[Object(p.jsx)(O.c,{"aria-controls":"panel1d-content",children:Object(p.jsx)(D.a,{children:"Method 1. Add asset from my wallet to Prepaid Interest"})}),Object(p.jsx)(O.b,{children:"panel3"===c&&Object(p.jsx)(H,{active:a,account:s,chainId:o,walletTokenBalance:i,onApprove:n,approveStatus:t})})]}),Object(p.jsxs)(O.a,{id:"panel4",expanded:"panel4"===c,onChange:r("panel4"),children:[Object(p.jsx)(O.c,{"aria-controls":"panel1d-content",children:Object(p.jsx)(D.a,{children:"Method 2. Transfer asset from Collateral to Prepaid Interest"})}),Object(p.jsx)(O.b,{children:"panel4"===c&&Object(p.jsx)(ye,{active:a,account:s,chainId:o,walletTokenBalance:i,onApprove:n,approveStatus:t})})]}),Object(p.jsxs)(O.a,{id:"panel5",expanded:"panel5"===c,onChange:r("panel5"),children:[Object(p.jsx)(O.c,{"aria-controls":"panel1d-content",children:Object(p.jsx)(D.a,{children:"Method 3. Neutralize outstanding debt"})}),Object(p.jsx)(O.b,{children:"panel5"===c&&Object(p.jsx)(ge,{})})]})]})}function ve(e){const{expanded:t,handleChange:n}=Object(R.a)(),{approveStatus:a,onApprove:o}=e,{walletTokenBalance:s}=Object(B.a)(),{active:i,chainId:c,account:r}=Object(l.b)();return Object(p.jsxs)(O.m,{children:[Object(p.jsx)(O.l,{children:"Improve Collateral Ratio"}),Object(p.jsxs)(O.a,{id:"panel7",expanded:"panel7"===t,onChange:n("panel7"),children:[Object(p.jsx)(O.c,{"aria-controls":"panel1d-content",children:Object(p.jsx)(D.a,{children:"Method 1. Add asset from my wallet to Prepaid Interest"})}),Object(p.jsx)(O.b,{children:"panel7"===t&&Object(p.jsx)(H,{active:i,account:r,chainId:c,walletTokenBalance:s,onApprove:o,approveStatus:a})})]}),Object(p.jsxs)(O.a,{id:"panel8",expanded:"panel8"===t,onChange:n("panel8"),children:[Object(p.jsx)(O.c,{"aria-controls":"panel1d-content",children:Object(p.jsx)(D.a,{children:"Method 2. Add asset from my wallet to Collateral"})}),Object(p.jsx)(O.b,{children:"panel8"===t&&Object(p.jsx)(U,{active:i,account:r,chainId:c,walletTokenBalance:s,onApprove:o,approveStatus:a})})]}),Object(p.jsxs)(O.a,{id:"panel9",expanded:"panel9"===t,onChange:n("panel9"),children:[Object(p.jsx)(O.c,{"aria-controls":"panel1d-content",children:Object(p.jsx)(D.a,{children:"Method 3. Neutralize outstanding debt"})}),Object(p.jsx)(O.b,{children:"panel9"===t&&Object(p.jsx)(ge,{})})]})]})}var Ce,Te=n(1004),Ie=n(715),we=n(511),Se=n.n(we),Ne=n(540),Ae=n.n(Ne);const Pe=Object(r.a)(x.c)(Ce||(Ce=Object(s.a)(["\n  box-shadow: none !important;\n  width: 34px !important;\n  height: 28px !important;\n  padding: 0 !important;\n  background: linear-gradient(90deg, #62c3f7 0%, #7ae9f1 100%) !important;\n  border-radius: 6px !important;\n  svg {\n    color: #000;\n    width: 16px;\n  }\n"]))),{ActionUser:Me,ActionMulticall:Ve}=Z.a,Fe=new Y.utils.Interface(Me.abi),De=new Y.utils.Interface(Ve.abi),Re=(e,t,n,a)=>{if(!e.destination)return;const{source:o,destination:s}=e;if(o.droppableId!==s.droppableId){const e=t[o.droppableId],a=t[s.droppableId],l=[...e.items],i=[...a.items],[c]=l.splice(o.index,1);i.splice(s.index,0,c),n([...a,i])}else{const e=[...t],[l]=e.splice(o.index,1);e.splice(s.index,0,l),e.map((e=>e.input>0)).includes(!1)?a(!0):a(!1),n(e)}};function Be(e){const{onApprove:t,approveStatus:n}=e,{chainId:o}=Object(l.b)(),{toastInfo:s,toastError:i,toastSuccess:c}=Object(k.a)(),{signer:r,tokenPools:d}=Object(K.a)(),[b,u]=Object(a.useState)([]),{expanded:j,handleChange:m}=Object(R.a)(),[h,f]=Object(a.useState)(!0),[g,y]=Object(a.useState)(!1),{onUpdateTotalCollateralValue:v,newDisplayCollateralRatio:C,newCollateralRatio:T,newDisplayPrepaidInterestCoverage:N}=Object(w.a)(),{handleUpdatePosition:V}=Object(w.b)(),{currentPositionTokenInfo:F,collateralIndex:B,currentPosition:E}=Object(w.c)(),z=Object(a.useMemo)((()=>{if(null!==F&&void 0!==F&&F.tokenPrice){const{allowedTokens:e}=F,t=Object.values(e.tokens).map((t=>{const n=(null===e||void 0===e?void 0:e.balances)&&Object(I.b)((null===e||void 0===e?void 0:e.balances[t.symbol])||0,t.decimals,!0)||0;return{decimals:t.decimals,token:t.symbol,balance:n,icon:()=>Object(p.jsx)(S.a,{imgprops:{style:{marginRight:10}},token:t.logo,symbol:t.symbol}),rightOptionList:[]}}));return t.map((e=>({...e,rightOptionList:t.filter((t=>t.token!==e.token))})))}return[]}),[F]),H=Object(a.useCallback)((()=>{u((e=>{const t=[...e,{id:Ae()(),input:0,output:0,inputToken:z[0],outputToken:z[0].rightOptionList[0]}];return t.map((e=>e.input>0)).includes(!1)?f(!0):f(!1),t}))}),[z]),L=Object(a.useCallback)((async()=>{const e=Object(A.b)(r,J,E.positionAddress);try{if(e){if(b.filter((e=>e.input<=0)).length)return void i(P.e.failed,"Please enter a valid amount");f(!0);const n=b.map((e=>{const t=Object(I.c)(String(e.input),e.inputToken.decimals),n=Object(I.c)(String(e.output),e.outputToken.decimals),{tokenAddressPath:a}=Object(Q.a)({chainId:o,from:e.inputToken.token,to:e.outputToken.token});return console.log(e.inputToken.token,e.outputToken.token,[t,"0",a,"999999999999999"]),[Me.address[o],Fe.encodeFunctionData("swapExactTokensForTokens",[t,n,a,"999999999999999"])]})),a=De.encodeFunctionData("multicall",[n]),l=await e.delegateCall(Ve.address[o],a);l.hash&&s(P.e.submited,Object(p.jsx)(M.a,{content:"Waiting for confirmation",txHash:l.hash}));if(await l.wait()){f(!0),v(0),c(P.e.success,Object(p.jsx)(M.b,{content:"The transaction has been successfully.",txHash:l.hash}));try{await V()}catch(t){console.error("handleUpdatePosition>>>>",t)}}}}catch(t){f(!1),i("Failed",Object(p.jsx)(O.g,{style:{flexDirection:"column"},children:Object(p.jsx)("p",{style:{wordBreak:"break-all"},children:t.reason})}))}}),[r,E.positionAddress,b,o,s,v,c,V,i]);Object(a.useEffect)((()=>{z.length&&u((()=>[{id:Ae()(),input:0,output:0,inputToken:z[0],outputToken:z[0].rightOptionList[0]}]))}),[z]);const U=Object(a.useCallback)(((e,t)=>{const n=I.a.formatTokenAmount(Number(e.target.value),t.inputToken.decimals);if(Number(n)>Number.MAX_SAFE_INTEGER)return void f(!0);const a=Object(Q.b)(o,t.inputToken.token,t.outputToken.token,Object(I.c)(n,t.inputToken.decimals),d)||0;u((o=>{const s=o.map((n=>({...n,input:n.id===t.id?e.target.value:n.input,output:n.id===t.id?Object(I.b)(a,t.outputToken.decimals,!0):n.output}))),l=s.reduce(((e,t)=>{const n={...e};return Object.prototype.hasOwnProperty.call(n,t.inputToken.token)?n[t.inputToken.token]+=Number(t.input):n[t.inputToken.token]=Number(t.input),n}),{});return s.map((e=>e.input>0&&e.output>0&&e.input<=e.inputToken.balance)).includes(!1)||-1!==n.indexOf(".")&&String(n).slice(n.indexOf(".")+1).length>t.inputToken.decimals?f(!0):f(!1),s.map((e=>e.input>0)).includes(!1)||l[t.inputToken.token]>t.inputToken.balance?f(!0):f(!1),s}))}),[o,d]),G=Object(a.useCallback)(((e,t,n)=>{u((a=>a.map((a=>{if(a.id===t){const t={...a,[n]:e};if(t.input){const e=Object(Q.b)(o,t.inputToken.token,t.outputToken.token,Object(I.c)(I.a.formatTokenAmount(t.input,t.inputToken.decimals),t.inputToken.decimals),d);t.output=Object(I.b)(e,t.outputToken.decimals,!0)}return t}return a}))))}),[o,d]),Z=Object(a.useCallback)(((e,t)=>{u((e=>e.map(((e,n)=>{if(n===t){const t={...e.outputToken,rightOptionList:[]};t.rightOptionList=[...e.inputToken.rightOptionList],t.rightOptionList.push(e.inputToken),t.rightOptionList=t.rightOptionList.filter((t=>t.token!==e.outputToken.token));return{...{...e,outputToken:e.inputToken,inputToken:{...t,balance:e.outputToken.balance},input:0,output:0}}}return e}))))}),[]);return Object(a.useEffect)((()=>{const{tokenPrice:e}=F;if(e){const t=b.map((e=>({from:e.inputToken.token,to:e.outputToken.token,fromDecimals:e.inputToken.decimals,toDecimals:e.outputToken.decimals,inputValue:Number(e.input),outputValue:Number(e.output)})));let n=0;t.forEach((t=>{n-=t.inputValue*Object(I.b)(e[t.from].price,E.mintTokenInfo.settlementCurrency.decimals,!0),n+=t.outputValue*Object(I.b)(e[t.to].price,E.mintTokenInfo.settlementCurrency.decimals,!0)})),v(n)}}),[b,E.mintTokenInfo.settlementCurrency.decimals,F,v]),Object(p.jsxs)(O.m,{children:[Object(p.jsx)(O.l,{children:"Trading through Collateral"}),Object(p.jsxs)(O.a,{id:"panel12",expanded:"panel12"===j,onChange:m("panel12"),children:[Object(p.jsx)(O.c,{"aria-controls":"panel1d-content",children:Object(p.jsx)(D.a,{children:"Method 1. Trading through Collateral"})}),Object(p.jsxs)(O.b,{children:[Object(p.jsx)(Ie.a,{onDragEnd:e=>Re(e,b,u,f),children:Object(p.jsx)(Ie.c,{droppableId:"droppableId",children:e=>Object(p.jsxs)("div",{...e.droppableProps,ref:e.innerRef,children:[b.map(((e,t)=>Object(p.jsx)(Ie.b,{draggableId:e.id,index:t,isDragDisabled:0===t,children:n=>{const a=d.length&&Object(Q.b)(o,e.inputToken.token,e.outputToken.token,Object(I.c)("1",e.inputToken.decimals),d)||0,s=Object(I.b)(a,e.outputToken.decimals,!0),l=I.a.formatFourDecimals(s);return Object(p.jsxs)("div",{ref:n.innerRef,...n.draggableProps,...n.dragHandleProps,style:{display:"flex",alignItems:"center",userSelect:"none",margin:"0 0 8px 0",...n.draggableProps.style,position:"static"},children:[Object(p.jsxs)("div",{style:{width:"100%",position:"relative",paddingRight:t<=0?58:0},children:[Object(p.jsx)(W.a,{SelectIcon:x.b,leftInputValue:e.input,rightInputValue:e.output,isExchange:!0,onExchange:()=>{Z(e,t)},options:z,leftSelectValue:e.inputToken.token,leftBalance:e.inputToken.balance,rightSelectValue:e.outputToken.token,rightBalance:e.outputToken.balance,rightOptions:e.inputToken.rightOptionList,selectedBalance:100,leftDisableStatus:[!1,!1],RightIcon:x.b,rightDisableStatus:[!1,!0],selectInput:t=>{U(t,e)},leftChange:t=>{G(t,e.id,"inputToken")},rightChange:t=>{G(t,e.id,"outputToken")},onMax:()=>{U({target:{value:e.inputToken.balance}},e)},leftSymbol:e.inputToken.token,rightSymbol:e.outputToken.token}),Object(p.jsxs)("p",{style:{position:"absolute",bottom:0,right:t<=0?73:15,color:"rgba(0, 0, 0, 0.5)",fontSize:12},children:["".concat(1," ",e.inputToken.token)," \u2248 ","".concat(l," ").concat(e.outputToken.token)]})]}),t>0?Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(Te.a,{onClick:()=>{const e=[...b];e.splice(t,1),e.map((e=>e.input>0)).includes(!1)?f(!0):f(!1),u(e)},style:{cursor:"pointer",marginTop:8,marginLeft:10,padding:0},children:Object(p.jsx)(x.f,{})}),Object(p.jsx)(Te.a,{style:{marginTop:8,marginLeft:8,padding:0},children:Object(p.jsx)(x.g,{style:{fill:"none"}})})]}):null]})}},e.id))),e.placeholder]})})}),Object(p.jsx)(Pe,{onClick:H,children:Object(p.jsx)(Se.a,{})}),Object(p.jsx)(_.a,{data:[[P.b.CollateralRatio,B.displayRatio,"".concat(0!==T&&T!==Number.POSITIVE_INFINITY?"\u2248":""," ").concat(C)],[P.b.PrepaidInterestCoverage,B.displayCoverage,N]]}),n?Object(p.jsx)(O.e,{style:{boxShadow:"none"},disabled:h,onClick:L,children:"Submit"}):Object(p.jsx)(O.e,{style:{boxShadow:"none"},disabled:g,onClick:()=>{t((e=>{y(e)}))},children:"Approve"})]})]})]})}var We,Ee=n(436);const ze=Object(r.a)("div")(We||(We=Object(s.a)(["\n  .balance_info {\n    display: flex;\n    align-content: center;\n    padding: 0 12px;\n    margin-bottom: 6px;\n    .label {\n      color: #000;\n      font-size: 14px;\n      font-family: PingFangSC-Medium, sans-serif;\n    }\n    span {\n      font-family: PingFangSC-Medium, sans-serif;\n      font-weight: 400;\n      font-size: 12px;\n      line-height: 17px;\n      color: rgba(0, 0, 0, 0.5);\n      margin-left: 7px;\n    }\n  }\n  .content {\n    display: flex;\n    height: 50px;\n    background: rgba(255, 255, 255, 0.4);\n    border: 1px solid rgba(207, 216, 226, 0.5);\n    box-sizing: border-box;\n    border-radius: 11px;\n    padding: 0 12px;\n    .select_custom {\n      margin: 0;\n      padding: 0;\n      border: none;\n      background: unset;\n      width: 200px;\n      flex-shrink: 0;\n    }\n    .select_custom:nth-of-type(2) {\n      width: 130px;\n    }\n    .MuiInput-root,\n    .MuiInput-input {\n      text-align: right;\n      width: 100%;\n      border: none;\n      &:before,\n      &:after {\n        display: none;\n      }\n    }\n    .MuiInput-input {\n      padding: 0 8px;\n      border-left: 1px solid rgba(207, 216, 226, 0.5) !important;\n\n      &::-webkit-inner-spin-button {\n        display: none;\n      }\n    }\n  }\n  .func {\n    font-size: 12px;\n    line-height: 17px;\n    color: #6ed6f3;\n    text-align: right;\n    padding: 0 20px;\n    margin-top: 3px;\n    cursor: pointer;\n    user-select: none;\n  }\n"])));var _e=function(e){return e.MyWallet="My Wallet",e.Standard="Collateral",e.Settlement="Prepaid Interest",e}(_e||{});const He=[{type:_e.MyWallet,token:"My Wallet",id:"d04155c3-eb41-4c44-b28d-67bb2d515904",icon:z.a},{type:_e.Settlement,token:"Prepaid Interest",icon:x.k,id:"edebd20e-18a1-4bc8-a869-9b44537d810c"},{type:_e.Standard,token:"Collateral",icon:x.b,id:"763c1484-3fd3-4044-b8b5-3c261947f414"}],{ActionUser:Le}=Z.a,Ue=new q.ethers.utils.Interface(Le.abi),Ge=e=>{const t=X.h[e];return X.f[t].decimals};function Ze(e){const{approveStatus:t,onApprove:n}=e,[o,s]=Object(a.useState)(!0),[i,c]=Object(a.useState)(!1),{signer:r,tokenPools:d}=Object(K.a)(),{walletTokenBalance:b,setRefresh:u}=Object(B.a)(),[j,m]=Object(a.useState)(!1),{toastInfo:f,toastSuccess:g,toastError:y}=Object(k.a)(),{currentPosition:v,currentPositionTokenInfo:C,collateralIndex:T}=Object(w.c)(),{onUpdateCollateralValue:N,onUpdatePrepaidInterest:A,newDisplayCollateralRatio:V,newDisplayPrepaidInterestCoverage:F,newCollateralRatio:W,newPrepaidInterestCoverage:E}=Object(w.a)(),{handleUpdatePosition:z}=Object(w.b)(),[H,U]=Object(a.useState)([{accountType:_e.MyWallet,tokenType:v.mintTokenInfo.symbol,transferVal:0,id:"1fee1a14-b8b3-4b73-b2be-1817a6d228ec",tokenSelectDisabled:!1,list:[...He],token:v.mintTokenInfo.settlementCurrency.symbol,decimals:v.mintTokenInfo.settlementCurrency.decimals},{accountType:_e.Standard,tokenType:v.mintTokenInfo.symbol,transferVal:0,id:"25897dcf-e843-4630-a5e1-309dc10cb1e5",tokenSelectDisabled:!0,list:[...He],token:v.mintTokenInfo.settlementCurrency.symbol,decimals:v.mintTokenInfo.settlementCurrency.decimals}]),G=Object(a.useMemo)((()=>{if(C.allowedTokens){const{balances:e,tokens:t}=C.allowedTokens;return Object.keys(e).reduce(((n,a)=>({...n,[a]:Object(I.b)(e[a],t[a].decimals,!0)})),{})}return Object.keys(X.h).reduce(((e,t)=>({...e,[t]:0})),{})}),[C.allowedTokens]),Z=Object(a.useMemo)((()=>{if(C.allowedTokens){const{tokens:e}=C.allowedTokens;return Object.keys(e).map((t=>({token:t,decimals:e[t].decimals,address:e[t].address,icon:()=>Object(p.jsx)(S.a,{imgprops:{style:{marginRight:10}},token:e[t].logo,symbol:t})})))}return[]}),[C.allowedTokens]),Y=Object(L.b)(),{expanded:q,handleChange:J}=Object(R.a)(),{active:$,chainId:ee,account:te}=Object(l.b)(),ne=Object(de.a)($,r),ae=Object(a.useCallback)((async()=>{if(!ne)return;m(!0);let e=null,t=!1;const n=[],[a,o]=H,{tokenType:l,accountType:i,transferVal:c}=a,r=Ge(l),d=Object(I.c)(I.a.formatTokenAmount(c,r),r),b=X.e[ee].tokens[X.h[l]].address;if(d.isZero())return;const j=e=>{console.log("results :>> ",e),m(!1),e.forEach((e=>{var t,n;"rejected"===e.status?y(P.e.failed,(null===(t=e.reason)||void 0===t?void 0:t.reason)||(null===(n=e.reason)||void 0===n?void 0:n.message)):(g(P.e.success,Object(p.jsx)(M.b,{content:"The transaction has been successfully.",txHash:e.value.transactionHash})),u((e=>!e)))}))},h=async e=>{try{const t=await ne.delegateCall(Le.address[ee],e);t&&(f(P.e.submited,Object(p.jsx)(M.a,{content:"Waiting for confirmation",txHash:t.hash})),await(async e=>{const t=await e.wait();t&&(g(P.e.success,Object(p.jsx)(M.b,{content:"The transaction has been successfully.",txHash:t.hash})),m(!1),s(!0),await z())})(t))}catch(t){(e=>{let{message:t,reason:n}=e;y("Failed","".concat(n||t)),m(!1)})(t)}};i===_e.MyWallet?o.accountType===_e.Settlement?e=Ue.encodeFunctionData("addGuarantee",[d,!1]):o.accountType===_e.Standard&&(n.push(Y(te,b,v.positionAddress,d)),t=!0):i===_e.Standard?o.accountType===_e.MyWallet?e=Ue.encodeFunctionData("withdrawAsset",[b,te,d]):o.accountType===_e.Settlement&&(e=Ue.encodeFunctionData("addGuarantee",[d,!0])):i===_e.Settlement&&(o.accountType===_e.MyWallet?e=Ue.encodeFunctionData("moveGuarantee",[te,d]):o.accountType===_e.Standard&&(e=Ue.encodeFunctionData("moveGuarantee",[v.positionAddress,d]))),!t&&e?await h(e):Promise.allSettled(n).then(j).catch((e=>{console.log("e :>> ",e),y(P.e.failed,e.reason),m(!1)}))}),[ne,H,ee,g,z,y,u,f,Y,te,v.positionAddress]),oe=Object(a.useCallback)(((e,t)=>{let{target:n}=e;const{value:a}=n;U((e=>e.map((e=>({...e,transferVal:a})))))}),[]);Object(a.useEffect)((()=>{const[e,t]=H;switch(e.accountType){case _e.MyWallet:t.accountType===_e.Settlement?A(e.transferVal):N({symbol:e.tokenType,value:Number(e.transferVal)});break;case _e.Standard:if(t.accountType===_e.MyWallet){const t=Number(e.transferVal);N({symbol:e.tokenType,value:t?Number("-".concat(t)):t})}else{const t=Number(e.transferVal);N({symbol:e.tokenType,value:t?Number("-".concat(t)):t}),A(e.transferVal)}break;case _e.Settlement:if(t.accountType===_e.MyWallet){const t=Number(e.transferVal);A(t?Number("-".concat(t)):t)}else{const t=Number(e.transferVal);A(t?Number("-".concat(t)):t),N({symbol:e.tokenType,value:Number(e.transferVal)})}break;default:console.log(1)}}),[H,N,A]);const se=Object(a.useCallback)(((e,t,n)=>{U((a=>{const o=a.map((n=>({...n,accountType:n.id===t.id?e:n.accountType,tokenType:e===_e.Settlement?v.mintTokenInfo.settlementCurrency.symbol:n.tokenType,transferVal:Number()})));return 0===n&&(o[1].list=He.filter((e=>e.type!==o[0].accountType)),o[0].tokenSelectDisabled=o[0].accountType===_e.Settlement),o}))}),[v.mintTokenInfo.settlementCurrency.symbol]),le=Object(a.useCallback)(((e,t)=>{U((t=>{const n=t.map((t=>({...t,tokenType:e,transferVal:Number()})));if(e!==v.mintTokenInfo.settlementCurrency.symbol)n[1].list=n[1].list.filter((e=>e.type!==_e.Settlement));else{const e=He.find((e=>e.type===_e.Settlement));n[1].list.findIndex((e=>e.type===_e.Settlement))>-1||n[1].list.push(e)}return n}))}),[v.mintTokenInfo.settlementCurrency.symbol]),ie=Object(a.useCallback)((e=>{U((t=>{const n=[...t],{settlementCurrency:a}=v.mintTokenInfo,{shortBalanceValue:o,estimatedDailyDebt:s,collateralValue:l}=v.positionStatus,i=Ge(e.tokenType);if(e.accountType===_e.MyWallet){const t=b[e.tokenType]||0;n[0].transferVal=t}else if(e.accountType===_e.Standard){const t=G[e.tokenType]||0,s=Number(I.a.formatTokenAmount(1.2*Number(Object(I.b)(o,a.decimals)),0));if(t>0){if(0===s)return n[0].transferVal=t,n[1].transferVal=t,n;const o=s-T.prepaidInterest;if(n[1].accountType===_e.Settlement&&(o>t?(n[0].transferVal=t,n[1].transferVal=t):(n[0].transferVal=o,n[1].transferVal=o)),n[1].accountType===_e.MyWallet){const s=Object(Q.b)(ee,e.tokenType,a.symbol,Object(I.c)(t,i),d),c=l.sub(s),r=o-Number(Object(I.b)(c,a.decimals)),b=Object(Q.b)(ee,a.symbol,e.tokenType,Object(I.c)(I.a.formatTokenAmount(r,a.decimals),a.decimals),d),p=Object(I.b)(b,i,!0);p>t?(n[0].transferVal=t,n[1].transferVal=t):p>0?(n[0].transferVal=Math.floor(t-p),n[1].transferVal=Math.floor(t-p)):(n[0].transferVal=t,n[1].transferVal=t)}}}else if(e.accountType===_e.Settlement){if(n[1].accountType===_e.MyWallet){const e=20*Number(Object(I.b)(s.toNumber(),a.decimals)),t=T.prepaidInterest-e;t>0&&(n[0].transferVal=Number(I.a.formatTokenAmount(t,a.decimals)))}if(n[1].accountType===_e.Standard){const e=20*Number(Object(I.b)(s.toNumber(),a.decimals)),t=T.prepaidInterest-e;t>0&&(n[0].transferVal=t)}}return n}))}),[G,ee,T,v.mintTokenInfo,v.positionStatus,d,b]);return Object(a.useEffect)((()=>{U((e=>[e[0],{...e[1],list:He.filter((t=>t.type!==e[0].accountType))}]))}),[]),Object(a.useEffect)((()=>{if(j)return void s(!0);const[e]=H,{decimals:t}=e;if(!e||!t)return;let n=0;const{transferVal:a}=e,o=Object(I.c)(I.a.formatTokenAmount(a,X.f[X.h[e.tokenType]].decimals),X.f[X.h[e.tokenType]].decimals);if(o.isZero())s(!0);else if(e.accountType===_e.MyWallet&&(n=b[e.tokenType]||0),e.accountType!==_e.Settlement&&e.accountType!==_e.Standard)e.transferVal<=0||e.transferVal>n||j?s(!0):s(!1);else{if(e.accountType===_e.Settlement){const{interestGuaranteed:e}=v.positionStatus;if(o.gt(e))return void s(!0)}if(e.accountType===_e.Standard){if(a>(G[e.tokenType]||0))return void s(!0)}s(W<120||E<20)}}),[H,G,v.positionStatus,W,E,j,b]),Object(p.jsxs)(O.m,{children:[Object(p.jsx)(O.l,{children:"General Transfer"}),Object(p.jsxs)(O.a,{id:"panel15",expanded:"panel15"===q,onChange:J("panel15"),children:[Object(p.jsx)(O.c,{"aria-controls":"panel1d-content",children:Object(p.jsx)(D.a,{children:"Method 1. Freestyle Transfer"})}),Object(p.jsxs)(O.b,{children:[H.map(((e,t)=>{let n=G&&G[e.tokenType]||0,a=b&&b[e.tokenType]||0;return String(n).includes(".")&&(n=I.a.formatFourDecimals(n)),String(a).includes(".")&&(a=I.a.formatFourDecimals(a)),Object(p.jsxs)("div",{children:[Object(p.jsxs)(ze,{children:[Object(p.jsxs)("div",{className:"balance_info",children:[Object(p.jsx)("span",{className:"label",children:"Balance: "}),e.accountType===_e.Standard&&Object(p.jsxs)("span",{children:[n," ",e.tokenType]}),e.accountType===_e.MyWallet&&Object(p.jsxs)("span",{children:[a," ",e.tokenType]}),e.accountType===_e.Settlement&&Object(p.jsxs)("span",{children:[I.a.formatFourDecimals(T.prepaidInterest)," ",v.mintTokenInfo.settlementCurrency.symbol]})]}),Object(p.jsxs)("div",{className:"content",children:[Object(p.jsx)(h.a,{options:e.list,onChange:n=>{se(n,e,t)},selectValue:e.accountType}),Object(p.jsx)(h.a,{options:Z,onChange:e=>{le(e,t)},selectValue:e.tokenType,selectDisabled:1===t||e.tokenSelectDisabled}),Object(p.jsx)(Ee.a,{value:e.transferVal,type:"number",onInput:t=>{oe(t,e)},disabled:1===t})]}),Object(p.jsx)("div",{hidden:1===t,className:"func",children:Object(p.jsx)("span",{onClick:()=>{ie(e)},onKeyUp:()=>null,tabIndex:0,role:"button",children:"Max"})})]}),0===t?Object(p.jsx)("div",{style:{display:"flex",alignItems:"center",height:30,justifyContent:"center"},children:Object(p.jsx)(x.h,{onClick:()=>{U((e=>{const t=e[0],n=e[1];return e.reverse().map(((e,a)=>({...e,list:0===a?t.list:He.filter((e=>e.type!==n.accountType)),tokenSelectDisabled:0===a?t.tokenSelectDisabled:n.tokenSelectDisabled})))}))},style:{fill:"none",transform:"rotate(90deg)",cursor:"pointer",width:22}})}):null]},e.id)})),Object(p.jsx)(_.a,{data:[[P.b.CollateralRatio,T.displayRatio,V],[P.b.PrepaidInterestCoverage,T.displayCoverage,F]]}),t?Object(p.jsx)(O.e,{style:{boxShadow:"none"},disabled:o,onClick:ae,children:"Submit"}):Object(p.jsx)(O.e,{style:{boxShadow:"none"},disabled:i,onClick:()=>{n((e=>{c(e)}))},children:"Approve"})]})]})]})}var Ye,qe,Ke,Je,Xe;const Qe=Object(r.a)("div")(Ye||(Ye=Object(s.a)(["\n  box-sizing: border-box;\n  margin-top: 18px;\n  padding-right: 44px;\n  overflow: auto;\n\n  & > .MuiGrid-root {\n    min-width: 1024px;\n  }\n\n  .account_panel {\n    height: calc(100vh - 189px);\n    padding-bottom: 100px;\n    overflow: auto;\n\n    &::-webkit-scrollbar {\n      display: none;\n    }\n  }\n\n  .asset_info {\n    padding: 0;\n    margin-top: 26px;\n  }\n"]))),$e=Object(r.a)(f.a)(qe||(qe=Object(s.a)(["\n  position: relative;\n  padding: 23px 0;\n  display: flex;\n  margin-bottom: 20px;\n\n  .avatar_info {\n    .avatar {\n      font-family: PingFangSC-Regular, sans-serif;\n      font-size: 12px;\n      line-height: 17px;\n      color: #000000;\n\n      & + svg {\n        margin-left: 10px;\n      }\n    }\n  }\n\n  .token_item {\n    justify-content: space-between;\n    align-items: center;\n    padding: 16px 0;\n\n    svg {\n      margin-right: 10px;\n\n      & + span {\n        margin-top: 5px;\n      }\n    }\n\n    .balance {\n      font-family: PingFangSC-Regular, sans-serif;\n\n      span:first-of-type {\n        font-size: 14px;\n        line-height: 20px;\n      }\n\n      span:last-of-type {\n        font-size: 12px;\n        line-height: 17px;\n        color: #747879;\n      }\n    }\n  }\n"]))),et=Object(r.a)("div")(Ke||(Ke=Object(s.a)(["\n  width: 50%;\n  padding: 0 30px 0 40px;\n  display: flex;\n  justify-content: space-between;\n\n  font-family: PingFangSC-Semibold, sans-serif;\n\n  > div {\n    width: calc(100% - 50px);\n  }\n\n  &:after {\n    content: '';\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    transform: translate(-50%, -50%);\n    width: 0.2px;\n    height: 70%;\n    background-color: #2da3ff;\n  }\n\n  h2 {\n    font-family: PingFangSC-Semibold, sans-serif;\n    font-weight: 550;\n    font-size: 1rem;\n    line-height: 22px;\n    color: #000000;\n  }\n\n  .num {\n    font-family: PingFangSC-Semibold, sans-serif;\n    font-weight: 550;\n    font-size: 50px;\n    line-height: 1;\n    color: #6ed6f3;\n    display: flex;\n    align-items: flex-end;\n    margin-bottom: 20px;\n    margin-top: 15px;\n    width: 100%;\n\n    span {\n      font-family: PingFangSC-Regular, sans-serif;\n      display: block;\n      max-width: 80%;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      white-space: nowrap;\n    }\n\n    sub {\n      margin-bottom: 5px;\n      font-size: 20px;\n      font-weight: 500;\n    }\n  }\n\n  .tip {\n    font-size: 12px;\n    line-height: 17px;\n    color: rgba(0, 0, 0, 0.5);\n  }\n\n  .num.guarantee {\n    color: #efd71e;\n  }\n"]))),tt=Object(r.a)($e)(Je||(Je=Object(s.a)(["\n  padding: 23px 0 !important;\n"]))),nt=Object(r.a)("div")(Xe||(Xe=Object(s.a)(["\n  padding: 20px;\n  background: rgba(255, 255, 255, 0.4);\n  box-shadow: 0 4px 27px rgba(0, 0, 0, 0.03);\n  border-radius: 8px;\n  margin-bottom: 20px;\n  .m_title {\n    font-size: 22px;\n    line-height: 31px;\n    font-weight: 500;\n    font-family: PingFangSC-Medium, sans-serif;\n    margin-bottom: 13px;\n  }\n  .list {\n    background: rgba(42, 161, 255, 0.07);\n    border-radius: 8px;\n    padding: 16px 16px 0;\n    margin-bottom: 18px;\n  }\n  .item {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    svg {\n      margin-right: 10px;\n    }\n    .item_title {\n      font-size: 18px;\n      font-family: PingFangSC-Semibold, sans-serif;\n      font-weight: 550;\n      line-height: 25px;\n      display: flex;\n      align-items: center;\n      margin-bottom: 20px;\n      img {\n        width: 24px;\n        margin-right: 10px;\n      }\n    }\n    .icon_symbol {\n      display: flex;\n      align-items: center;\n      font-family: PingFangSC-Medium, sans-serif;\n      font-weight: 500;\n      font-size: 14px;\n    }\n    span {\n      font-family: PingFangSC-Regular, sans-serif;\n      font-size: 14px;\n    }\n    &.currency {\n      padding: 22px 0;\n      border-top: 0.5px solid rgba(0, 0, 0, 0.13);\n    }\n    &.item_head {\n      padding-bottom: 14px;\n      span {\n        font-family: PingFangSC-Medium, sans-serif;\n        font-weight: 500;\n        font-size: 12px;\n        line-height: 17px;\n        color: rgba(0, 0, 0, 0.6);\n      }\n    }\n    .balance span {\n      line-height: 20px;\n      &:last-of-type {\n        opacity: 0.5;\n      }\n    }\n  }\n  .avatar .currency {\n    padding: 15px 0;\n  }\n  .avatar_address {\n    display: flex;\n    align-items: center;\n    padding-left: 16px;\n    line-height: 17px;\n    * {\n      font-size: 12px;\n      font-weight: normal !important;\n      color: #000 !important;\n      font-family: PingFangSC-Regular, sans-serif !important;\n    }\n  }\n\n  .asset_list_title {\n    font-family: PingFangSC-Medium, sans-serif;\n    font-weight: 500;\n    font-size: 22px;\n    line-height: 22px;\n    color: #000000;\n    margin-bottom: 22px;\n  }\n  .outstandingDebt {\n    span {\n      font-size: 14px;\n    }\n    div {\n      font-family: PingFangSC-Medium, sans-serif;\n      font-weight: 500;\n      margin-bottom: 5px;\n      svg {\n        margin-right: 10px;\n      }\n    }\n    span:last-of-type {\n      font-family: PingFangSC-Regular, sans-serif;\n      font-weight: 400;\n    }\n  }\n"]))),at=e=>1*e>=400?"rgb(29, 202, 218)":1*e>200?"rgb(255, 204, 4)":"rgb(255, 99, 8)";var ot=Object(c.h)((function(){const e=o.a.useRef(),{expanded:t}=Object(R.a)(),[n,s]=Object(a.useState)(!1),{currentPosition:c,currentPositionTokenInfo:r,currentMintToken:b}=Object(w.c)(),{handleChangeCurrentPosition:u}=Object(w.b)(),{account:m,chainId:f}=Object(l.b)(),{toastSuccess:C,toastError:D,toastWarning:B}=Object(k.a)(),W=Object(a.useCallback)((e=>{u(e)}),[u]),{handleApprove:E}=Object(y.a)(m,null===c||void 0===c?void 0:c.mintTokenInfo.settlementCurrency.address),{onCheckApprove:z}=Object(y.b)(),_=Object(a.useCallback)((async()=>{if(c&&c.isEnable){const e=await z(m,c.mintTokenInfo.settlementCurrency.address,c.positionAddress);return e&&e._hex>0?s(!0):s(!1),e}return 0}),[m,c,z]),H=Object(a.useCallback)((async e=>{if(c&&c.isEnable)try{e&&e(!0);const t=await E(c.positionAddress);if(t.hash){const n=await t.wait();n&&_().then((t=>{e&&e(!1),t._hex>0?(s(!0),C(P.e.success,Object(p.jsx)(M.b,{txHash:n.transactionHash,content:"The approve has been successfully"}))):(s(!1),B("Approve Warning","Approval is zero. You will not be able to perform any transactions."))}))}}catch(t){e&&e(!1),D(P.e.failed,"".concat(t.reason))}}),[c,E,_,C,B,D]),L=Object(a.useMemo)((()=>c&&c.collateralRatio?c.collateralRatio===Number.POSITIVE_INFINITY?"+\u221e":I.a.formatTokenAmount(c.collateralRatio,2):"0"),[c]),U=Object(a.useMemo)((()=>c&&c.prepaidInterestCoverage?c.prepaidInterestCoverage===Number.POSITIVE_INFINITY?"+\u221e":I.a.formatTokenAmount(c.prepaidInterestCoverage,0):"0"),[c]),Z=Object(a.useMemo)((()=>{if(c){const e=Object(I.b)(c.positionStatus.interestGuaranteed.sub(c.positionStatus.obligation).sub(c.positionStatus.epochDebt).sub(c.positionStatus.estimatedObligationToday),c.mintTokenInfo.settlementCurrency.decimals);return I.a.formatTokenAmount(Number(e),4)}return 0}),[c]);Object(a.useEffect)((()=>{_(),t&&-1!==Number(t)&&e&&"panel1"!==t&&"panel2"!==t&&setTimeout((()=>{const e=document.querySelector("#".concat(t));e&&e.scrollIntoView()}),500)}),[_,c,t]);const Y=Object(a.useMemo)((()=>{var e;if(!r)return null;const t=r.tokenPrice,n=r.allowedTokens,a=null===(e=r.allowedTokens)||void 0===e?void 0:e.balances,o=r.WBTCToUSD;return Object.values(n.tokens).map((e=>{var n;return Object(p.jsxs)("div",{className:"item currency",children:[Object(p.jsxs)("div",{className:"icon_symbol",children:[Object(p.jsx)(S.a,{token:e.logo,symbol:e.symbol,imgprops:{style:{marginRight:10}}}),e.symbol]}),Object(p.jsxs)(O.g,{className:"balance",style:{flexDirection:"column",alignItems:"flex-end"},children:[Object(p.jsx)("span",{children:a&&Object(I.b)(a[e.symbol],e.decimals)||0}),Object(p.jsxs)("span",{children:["\u2248"," ",a&&I.a.formatCurrencyTwoDecimals(a[e.symbol].toNumber()*(null===(n=t[e.symbol])||void 0===n?void 0:n.price.toNumber())*o/10**6)||0]})]})]},e.symbol)}))}),[r]),q=Object(a.useMemo)((()=>{if(Object(A.f)(f)){const e=N.c[f].tokens;return Object.keys(N.c[f].tokens).map((t=>({token:e[t].symbol,address:e[t].address,decimals:e[t].decimals,icon:()=>Object(p.jsx)(S.a,{imgprops:{style:{marginRight:10}},token:e[t].logo,symbol:e[t].symbol})})))}return[]}),[f]);return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(F.a,{style:{marginBottom:4},children:"Collateral Management"}),Object(p.jsx)(T,{children:"Make sure the collateral ratio is higher than the Liquidation Ratio, and the Prepaid Interest Coverage is higher than the Liquidation Threshold."}),Object(p.jsx)(h.a,{isGroup:!1,options:q,selectValue:b,onChange:W}),Object(p.jsx)(Qe,{children:null!==c&&void 0!==c&&c.isEnable?Object(p.jsxs)(d.a,{container:!0,spacing:2.5,children:[Object(p.jsx)(d.a,{item:!0,xs:8,children:Object(p.jsxs)(O.i,{ref:e,children:[Object(p.jsxs)(tt,{children:[Object(p.jsxs)(et,{children:[Object(p.jsxs)("div",{title:"Collateral Ratio: ".concat(L),children:[Object(p.jsx)("h2",{children:"Collateral Ratio"}),c.collateralRatio?Object(p.jsx)("p",{className:"num",children:c.collateralRatio?Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("span",{style:{color:at(null===c||void 0===c?void 0:c.collateralRatio)},children:L}),(null===c||void 0===c?void 0:c.collateralRatio)===Number.POSITIVE_INFINITY?null:Object(p.jsx)("sub",{style:{color:at(null===c||void 0===c?void 0:c.collateralRatio)},children:"%"})]}):Object(p.jsx)("span",{style:{color:"rgb(255, 99, 8)"},children:"0"})}):Object(p.jsx)("p",{className:"tip",style:{lineHeight:"85px"},children:"Add collateral before mint"}),Object(p.jsxs)("p",{className:"tip",children:["Liquidation Ratio\uff1a",V.a.ratio,"%"]})]}),Object(p.jsx)(j,{style:{height:"100%"},value:c.isEnable&&"0"!==L?((null===c||void 0===c?void 0:c.collateralRatio)-100)/5:0})]}),Object(p.jsxs)(et,{children:[Object(p.jsxs)("div",{title:"Prepaid Interest Coverage: ".concat(U," days"),children:[Object(p.jsx)("h2",{children:"Prepaid Interest Coverage"}),c.prepaidInterestCoverage?Object(p.jsx)("p",{className:"num guarantee",children:c.prepaidInterestCoverage?Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("sub",{style:{color:at(c.prepaidInterestCoverage)},children:"\u2248"}),Object(p.jsx)("span",{style:{color:at(c.prepaidInterestCoverage)},children:U}),c.prepaidInterestCoverage===Number.POSITIVE_INFINITY?null:Object(p.jsx)("sub",{style:{color:at(c.prepaidInterestCoverage)},children:"days"})]}):Object(p.jsx)("span",{style:{color:"rgb(255, 99, 8)"},children:"0"})}):Object(p.jsx)("p",{className:"tip",style:{lineHeight:"85px"},children:"Add collateral before mint"}),Object(p.jsxs)("p",{className:"tip",children:["Liquidation Threshold: ",V.a.days," days"]})," "]}),Object(p.jsx)(j,{style:{height:"100%"},value:c.prepaidInterestCoverage/5})]})]}),Object(p.jsx)(G,{onApprove:H,approveStatus:n}),Object(p.jsx)(ke,{onApprove:H,approveStatus:n}),Object(p.jsx)(ve,{onApprove:H,approveStatus:n}),Object(p.jsx)(Be,{onApprove:H,approveStatus:n}),Object(p.jsx)(ne,{onApprove:H,approveStatus:n}),Object(p.jsx)(Ze,{onApprove:H,approveStatus:n})]})}),Object(p.jsxs)(d.a,{item:!0,xs:4,className:"account_panel",children:[Object(p.jsxs)(nt,{children:[Object(p.jsx)("h3",{className:"m_title",children:"Total Collateral"}),Object(p.jsxs)("div",{className:"list guarantee",children:[Object(p.jsx)("div",{className:"item",children:Object(p.jsxs)("h4",{className:"item_title",children:[Object(p.jsx)("img",{src:v.a.PrepaidInterest,alt:""}),"Prepaid Interest"]})}),Object(p.jsxs)("div",{className:"item currency",children:[Object(p.jsxs)("span",{className:"icon_symbol",children:[Object(p.jsx)(S.a,{token:null===c||void 0===c?void 0:c.mintTokenInfo.settlementCurrency.logo,symbol:null===c||void 0===c?void 0:c.mintTokenInfo.settlementCurrency.symbol}),Object(p.jsx)("span",{style:{marginLeft:"10px"},children:null===c||void 0===c?void 0:c.mintTokenInfo.settlementCurrency.symbol})]}),Object(p.jsx)("span",{children:Z})]})]}),Object(p.jsxs)("div",{className:"list avatar",style:{marginBottom:12},children:[Object(p.jsx)("div",{className:"item",children:Object(p.jsxs)("h4",{className:"item_title",children:[Object(p.jsx)("img",{src:v.a.Collateral,alt:""}),"Collateral"]})}),Object(p.jsxs)("div",{className:"item item_head",children:[Object(p.jsx)("span",{children:"Ticker"}),Object(p.jsx)("span",{children:"Holdings - In Collateral"})]}),Y]}),Object(p.jsxs)("div",{className:"avatar_address",children:[Object(p.jsx)("span",{children:"Collateral Account Address: \xa0\xa0"})," ",Object(p.jsx)(g.a,{toCopy:(null===c||void 0===c?void 0:c.positionAddress)||"",children:c?"".concat(null===c||void 0===c?void 0:c.positionAddress.slice(0,6),"...").concat(null===c||void 0===c?void 0:c.positionAddress.slice(-6)):""})]})]}),Object(p.jsxs)(nt,{children:[Object(p.jsx)("h3",{className:"asset_list_title",children:"My Outstanding Debt"}),Object(p.jsxs)(O.g,{className:"outstandingDebt",style:{alignItems:"center",justifyContent:"space-between"},children:[Object(p.jsxs)(O.g,{style:{alignItems:"center"},children:[Object(p.jsx)(x.j,{className:"icon"}),null===c||void 0===c?void 0:c.mintTokenInfo.symbol]}),Object(p.jsx)("span",{children:I.a.formatFourDecimals(Number(Object(I.b)(c.balance,c.mintTokenInfo.decimals)))})]})]}),Object(p.jsx)(nt,{style:{padding:30},children:Object(p.jsx)("img",{src:v.a.CollateralManage,style:{width:"100%"},alt:""})})]})]}):Object(p.jsxs)(i.b,{to:"/collateral",style:{color:"#2AA1FF"},children:["Please enable the collateral first",Object(p.jsx)(x.a,{})," "]})})]})}));t.default=function(){return Object(p.jsx)(ot,{})}},442:function(e,t,n){"use strict";var a=n(1),o=n(147);t.a=()=>{const e=Object(a.useContext)(o.a);if(void 0===e)throw new Error("hashPowerToken context undefined");return e}},453:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));n(1);var a=n(0);function o(e){return Object(a.jsx)("img",{...e.imgprops,src:e.token,alt:e.symbol})}},459:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n(39),o=n(56);function s(){const e=Object(a.c)((e=>e.collateralManage.expanded)),t=Object(a.b)();return{expanded:e,handleChange:e=>(n,a)=>{t(Object(o.b)({expanded:a?e:"-1"}))},setExpanded:e=>{t(Object(o.b)({expanded:e||"-1"}))}}}},461:function(e,t,n){"use strict";var a,o=n(7),s=(n(1),n(18)),l=n(0);const i=Object(s.a)("div")(a||(a=Object(o.a)(["\n  background: #def1ff;\n  border-radius: 14px;\n  padding: 13px 22px;\n  margin: 20px 0;\n\n  table {\n    width: 100%;\n  }\n\n  td {\n    font-family: PingFangSC-Regular, sans-serif;\n    font-weight: 400;\n    font-size: 12px;\n    padding: 5px 0;\n  }\n\n  .label {\n    text-align: left;\n    width: 30%;\n  }\n\n  .from,\n  .to {\n    width: 35%;\n    line-height: 17px;\n    text-align: right;\n  }\n\n  .to {\n    font-family: PingFangSC-Medium, sans-serif;\n    font-weight: 500;\n    color: #000;\n  }\n\n  .borderTop {\n    border-top: 0.5px solid rgba(0, 0, 0, 0.12);\n  }\n"])));t.a=function(e){const{data:t}=e;return Object(l.jsx)(i,{children:Object(l.jsx)("table",{children:Object(l.jsxs)("tbody",{children:[Object(l.jsxs)("tr",{children:[Object(l.jsx)("td",{className:"from",colSpan:2,children:"From"}),Object(l.jsx)("td",{className:"to",children:"To"})]}),t.map((e=>Object(l.jsxs)("tr",{className:e[3]?"borderTop":"",children:[Object(l.jsx)("td",{className:"label",children:e[0]}),Object(l.jsx)("td",{className:"from",children:e[1]}),Object(l.jsx)("td",{className:"to",children:e[2]})]},e[0])))]})})})}},473:function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var a,o,s,l=n(7),i=n(1),c=n(18),r=n(16),d=n(229),b=n(19),p=n(125),u=n(0);const j=Object(c.a)("div")(a||(a=Object(l.a)(["\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  position: static !important;\n"]))),m=Object(c.a)("div")(o||(o=Object(l.a)(["\n  display: flex;\n  flex-direction: column;\n  width: calc(100% / 2 - 25px);\n\n  p {\n    height: 28px;\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 0 15px;\n    box-sizing: border-box;\n\n    span {\n      font-size: 12px;\n      line-height: 17px;\n      color: rgba(0, 0, 0, 0.5);\n    }\n  }\n\n  .maxBtn {\n    height: 21px;\n    align-items: flex-end;\n  }\n"])));Object(c.a)("strong")(s||(s=Object(l.a)(["\n  display: block;\n  width: 20px;\n  height: 20px;\n  background: #c4c4c4;\n  line-height: 20px;\n  text-align: center;\n  border-radius: 50%;\n"])));function h(e){const{options:t,leftBalance:n,isExchange:a,onExchange:o,onMax:s,selectInput:l,rightSelectInput:c,SelectIcon:h,RightIcon:f,leftInputValue:x,rightInputValue:O,rightBalance:g,rightDisableStatus:y,leftChange:k,rightChange:v,leftDisableStatus:C=[!1,!1],leftSelectValue:T,rightSelectValue:I,rightOptions:w,leftSymbol:S,rightSymbol:N,rightNumberIsShow:A=!0,leftDesc:P,rightDesc:M}=e,[V,F]=Object(i.useState)(t&&t.length?t[0]:{}),[D,R]=Object(i.useState)(t&&t.length?t[0].rightOptionList:[]),[B,W]=Object(i.useState)(D?D[0]:{});Object(i.useEffect)((()=>{t&&t.length&&T&&I&&(F(t.filter((e=>e.token===T))[0]||t[0]),R(t[0].rightOptionList),W(t[0].rightOptionList.filter((e=>e.token===I))[0]||t[0].rightOptionList[0]))}),[T,t,I]);const E=Object(i.useMemo)((()=>{const e=g||B&&B.balance||0,t=n||V.balance||0;return{right:{orignalBalance:e,balance:r.a.formatFourDecimals(e),symbol:N||(B&&Object.keys(B)?B.token:"WBTC")},left:{orignalBalance:t,balance:r.a.formatFourDecimals(t),symbol:S||V.token||"WBTC"}}}),[V,n,S,g,N,B]);return Object(u.jsx)(u.Fragment,{children:Object(u.jsxs)(j,{children:[Object(u.jsxs)(m,{children:[Object(u.jsxs)("p",{title:"".concat(E.left.symbol," Balance: ").concat(E.left.orignalBalance),children:[Object(u.jsx)(h,{}),Object(u.jsxs)("span",{className:"balance",children:[E.left.balance," ",E.left.symbol]})]}),Object(u.jsx)(d.a,{selectValue:T||V.token,allDisabled:!C||C[0]&&C[1],inputDisabled:!C||C[1],selectDisabled:!C||C[0],onChange:e=>{const n=t.filter((t=>t.token===e))[0];R(n.rightOptionList),W(n.rightOptionList[0]),F(n),k&&k(n)},selectInput:l,actionValue:x,options:t,groupStyle:{width:"100%"},isGroup:!0},1),Object(u.jsxs)(p.g,{style:{justifyContent:"space-between",alignItems:"center"},children:[P&&P,Object(u.jsx)("p",{dir:"rtl",style:{width:"100%"},className:"maxBtn",children:Object(u.jsx)("span",{onClick:()=>{s&&s(V)},onKeyUp:()=>null,tabIndex:0,role:"button",style:{cursor:"pointer",color:"#6ED6F3",fontSize:"0.75rem",userSelect:"none"},children:"Max"})})]})]}),a?Object(u.jsx)(b.h,{onClick:o,style:{fill:"none",cursor:"pointer",width:22,marginTop:8}}):Object(u.jsx)(b.s,{style:{fill:"none",width:22,marginTop:8}}),Object(u.jsxs)(m,{children:[Object(u.jsxs)("p",{title:A?"".concat(E.right.symbol," Balance: ").concat(E.right.orignalBalance):"",children:[Object(u.jsx)(f,{}),A?Object(u.jsxs)("span",{className:"balance",children:[E.right.balance," ",E.right.symbol]}):null]}),Object(u.jsx)(d.a,{selectValue:I||(B?B.token:"WBTC"),options:w||D,actionValue:O,groupStyle:{width:"100%"},isGroup:!0,allDisabled:!y||y[0]&&y[1],inputDisabled:!y||y[1],selectDisabled:!y||y[0],selectInput:c,onChange:e=>{if(V){const t=V.rightOptionList.filter((t=>t.token===e))[0];v&&v(t),W(t)}else{const n=t[0].filter((t=>t.token===e))[0];v&&v(n),W(n)}}},2),Object(u.jsxs)(p.g,{style:{justifyContent:"space-between",alignItems:"center"},children:[M&&M,Object(u.jsx)("p",{dir:"rtl",style:{width:"100%"},className:"maxBtn"})]})]})]})})}},492:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return d}));var a=n(28),o=n(1),s=n(14),l=n(15),i=n(70),c=n(110);function r(){const{active:e}=Object(a.b)(),{signer:t}=Object(c.a)();return{onCheckApprove:Object(o.useCallback)((async(n,a,o)=>{if(e)try{const e=Object(l.b)(t,i,a);if(e){return await e.allowance(n,o)}}catch(s){return console.error("Failed to check approval",s),null}return null}),[e,t])}}function d(e,t){const{active:n,library:c,chainId:r}=Object(a.b)();return{handleApprove:Object(o.useCallback)((async a=>{if(n&&r){const n=Object(l.e)(c,e),o=Object(l.b)(n,i,t&&"object"===typeof t?t[r]:t);if(o)return o.approve(a,s.ethers.constants.MaxUint256)}return null}),[n,r,c,e,t])}}},541:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return o}));const a={days:10,ratio:110},o={days:20,ratio:120}},542:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(1),o=n(15),s=n(111),l=n(39);function i(e,t){const[n,i]=Object(a.useState)(null),c=Object(l.c)((e=>e.collateralManage.currentCPT));return Object(a.useEffect)((()=>{if(e&&t&&c&&Number(c.position)){const e=Object(o.b)(t,s,c.position);i(e)}}),[e,c,t]),n}},604:function(e,t,n){"use strict";var a,o=n(7),s=n(18);const l=Object(s.a)("h1")(a||(a=Object(o.a)(["\n  font-family: 'Heebo Medium';\n  font-style: normal;\n  font-weight: 500;\n  font-size: 32px;\n  line-height: 47px;\n  margin-bottom: 14px;\n  color: #000000;\n"])));t.a=l}}]);
//# sourceMappingURL=13.8a85c549.chunk.js.map